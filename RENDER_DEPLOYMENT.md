# Render Deployment Guide for Outre Couture Backend

## Prerequisites

1. A Render account (sign up at https://render.com)
2. Your MongoDB Atlas connection string
3. Email credentials (if using email notifications)
4. This repository pushed to GitHub/GitLab

## Deployment Steps

### Option 1: Deploy Using render.yaml (Recommended)

This method automatically creates all environments (dev, staging, production) from the `render.yaml` file.

1. **Connect Your Repository to Render**

   - Log in to Render Dashboard
   - Click "New +" → "Blueprint"
   - Connect your GitHub/GitLab repository
   - Select the repository containing this backend
   - Render will automatically detect the `render.yaml` file

2. **Configure Environment Variables**

   After deployment is initiated, you'll need to set these environment variables for each service:

   **Required Variables:**

   - `MONGO_URI` - Your MongoDB connection string from MongoDB Atlas
   - `FRONTEND_URL` - Your frontend URL (e.g., https://your-frontend.com)

   **Optional but Recommended:**

   - `MAIL_USERNAME` - Your email address for sending emails
   - `MAIL_PASSWORD` - Your email password or app-specific password
   - `MAIL_DEFAULT_SENDER` - Email address to send from

   **Note:** `JWT_SECRET_KEY` is automatically generated by Render

3. **Deploy**
   - Click "Apply" to create all services
   - Render will create three services:
     - `outre-couture-backend-dev`
     - `outre-couture-backend-staging`
     - `outre-couture-backend-prod`

### Option 2: Manual Deployment (Single Service)

If you want to deploy just one environment:

1. **Create a New Web Service**

   - Go to Render Dashboard
   - Click "New +" → "Web Service"
   - Connect your repository

2. **Configure Build Settings**

   - **Name:** Choose a name (e.g., outre-couture-backend)
   - **Environment:** Python 3
   - **Build Command:** `pip install -r requirements.txt`
   - **Start Command:** `gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 60`
   - **Plan:** Free (or choose paid plan for better performance)

3. **Add Environment Variables**

   Go to "Environment" tab and add:

   ```
   PYTHON_VERSION=3.9.16
   FLASK_ENV=production
   MONGO_URI=<your-mongodb-connection-string>
   JWT_SECRET_KEY=<auto-generate-or-provide-your-own>
   FLASK_DEBUG=false
   BASE_URL=<your-render-service-url>/api
   FRONTEND_URL=<your-frontend-url>
   API_HOST=0.0.0.0
   JWT_EXPIRATION_HOURS=24
   JWT_REFRESH_EXPIRATION_DAYS=7
   BCRYPT_ROUNDS=12
   PASSWORD_MIN_LENGTH=8
   MAX_LOGIN_ATTEMPTS=5
   LOGIN_LOCKOUT_MINUTES=15

   # Optional Email Settings
   MAIL_SERVER=smtp.gmail.com
   MAIL_PORT=587
   MAIL_USE_TLS=true
   MAIL_USERNAME=<your-email>
   MAIL_PASSWORD=<your-email-password>
   MAIL_DEFAULT_SENDER=<your-email>
   ADMIN_EMAIL=admin@outrecouture.com
   ```

4. **Deploy**
   - Click "Create Web Service"
   - Wait for the deployment to complete

## Post-Deployment Steps

### 1. Update FRONTEND_URL

After your backend is deployed, update the `FRONTEND_URL` environment variable with your actual frontend URL to enable CORS properly.

### 2. Update BASE_URL

The `BASE_URL` should match your Render service URL:

- Dev: `https://outre-couture-backend-dev.onrender.com/api`
- Staging: `https://outre-couture-backend-staging.onrender.com/api`
- Production: `https://outre-couture-backend-prod.onrender.com/api`

### 3. Test the Health Endpoint

Once deployed, test your API:

```bash
curl https://your-service-url.onrender.com/api/health
```

Expected response:

```json
{
  "success": true,
  "status": "healthy",
  "environment": "production",
  "database": "connected",
  "timestamp": "2025-12-23T..."
}
```

### 4. Create Admin User

After successful deployment, create an admin user by running the create_admin.py script locally:

```bash
# Make sure to set MONGO_URI environment variable to your production database
python create_admin.py
```

Or use the `/api/auth/register` endpoint with admin role (if you've set up proper authentication).

## MongoDB Atlas Setup

1. **Whitelist Render's IP Addresses**

   - Go to MongoDB Atlas → Network Access
   - Click "Add IP Address"
   - Add `0.0.0.0/0` to allow all connections (Render uses dynamic IPs)
   - Or use Render's specific IP ranges if available

2. **Get Connection String**
   - Go to MongoDB Atlas → Database → Connect
   - Choose "Connect your application"
   - Copy the connection string
   - Replace `<password>` with your actual database password
   - Use this as the `MONGO_URI` environment variable

## Gmail Setup (for Email Notifications)

If using Gmail for email notifications:

1. **Enable 2-Factor Authentication** on your Google account
2. **Generate App Password**
   - Go to Google Account → Security → 2-Step Verification → App passwords
   - Generate a new app password for "Mail"
   - Use this password as `MAIL_PASSWORD`

## Important Notes

### Free Tier Limitations

Render's free tier:

- Spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds (cold start)
- 750 hours/month free (enough for one service running 24/7)
- Consider upgrading to paid plan for production

### Multiple Environments

The `render.yaml` creates three separate services:

- **Dev:** For development and testing
- **Staging:** For pre-production testing
- **Production:** For live application

Each service has its own URL and environment variables. Make sure to set the appropriate values for each.

### Auto-Deploy

By default, Render auto-deploys when you push to your main branch. You can configure this in the service settings.

### Monitoring

Monitor your application:

- View logs in Render Dashboard → Your Service → Logs
- Check deployment status
- Monitor resource usage

## Troubleshooting

### Application Won't Start

1. Check logs in Render Dashboard
2. Verify all required environment variables are set
3. Ensure MongoDB connection string is correct
4. Check that `MONGO_URI` includes the database name

### Database Connection Issues

1. Verify MongoDB Atlas Network Access allows Render's IPs
2. Check connection string format
3. Ensure database user has proper permissions

### Email Sending Fails

1. Verify Gmail app password is correct
2. Check that 2FA is enabled on Google account
3. Ensure `MAIL_USERNAME` and `MAIL_PASSWORD` are set

### CORS Errors

1. Update `FRONTEND_URL` with your actual frontend URL
2. Restart the service after updating environment variables

## Updating Your Application

To deploy updates:

1. Push changes to your repository
2. Render will automatically detect and deploy
3. Monitor deployment in Render Dashboard

Manual deployment:

- Go to your service in Render Dashboard
- Click "Manual Deploy" → "Deploy latest commit"

## Support

- Render Documentation: https://render.com/docs
- MongoDB Atlas Docs: https://docs.atlas.mongodb.com
- Flask Documentation: https://flask.palletsprojects.com

## Security Best Practices

1. **Never commit .env files** - Already configured in .gitignore
2. **Use strong JWT_SECRET_KEY** - Auto-generated by Render
3. **Whitelist specific IPs** in MongoDB Atlas if possible
4. **Use environment variables** for all sensitive data
5. **Enable HTTPS** - Render provides this automatically
6. **Regular backups** of MongoDB Atlas database
7. **Monitor logs** for suspicious activity
